<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="layui/css/layui.css">
    <script src="layui/layui.js"></script>
    <title>frame</title>
</head>
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<body>
    <div style="position: fixed;top: 10%;left: 10%">
        <table id="demo" lay-filter="test"></table>
    </div>

    <!-- <script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
      <button class="layui-btn layui-btn-sm" lay-event="add">添加</button>
      <button class="layui-btn layui-btn-sm" lay-event="delete">删除</button>
      <button class="layui-btn layui-btn-sm" lay-event="update">编辑</button>
    </div>
  </script> -->
    <script type="text/html" id="barDemo">
    <div class="layui-btn-container">
        <a class="layui-btn layui-btn-sm" lay-event="update">编辑</a>
        <a class="layui-btn layui-btn-danger layui-btn-sm" lay-event="delete">删除</a>
    </div>
    </script>
    <script>
        var table = layui.table;
        layui.use('table', function () {
            table.render({
                elem: '#demo'
                , height: 312
                , url: "/list"//数据接口
                , page: true //开启分页
                , cols: [[ //表头
                    { field: 'id', title: 'ID', width: 100, sort: true }
                    , { field: 'name', title: '学生姓名', width: 100 }
                    , { field: 'pwd', title: '学生密码', width: 100 }
                    , { field: 'email', title: '学生邮箱', width: 200 }
                    , { field: 'birthday', title: '学生生日', width: 110 }
                    , { field: 'remain', title: '学生余额', width: 110 }
                    , { field: '编辑', toolbar: '#barDemo' }
                ]]
            });

        });
        //工具条事件
        table.on('tool(test)', function (obj) { //注：tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
            var data = obj.data; //获得当前行数据
            var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
            var tr = obj.tr; //获得当前行 tr 的 DOM 对象（如果有的话）

            if (layEvent === 'detail') { //查看
                //do somehing
            } else if (layEvent === 'delete') { //删除
                layer.confirm('真的删除该用户吗', function (index) {
                    //alert(data.name);
                    $.ajax({
                        url:"/delete",
                        type:"delete",
                        dataType:"json",
                        data:{
                            name:data.name
                        },
                        success:function (result) {
                            if(result.status==0)
                                alert("删除成功");
                            else alert("用户名密码错误");
                        },
                        error:function (){
                            alert("未知错误");
                        }
                    });
                    obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
                    layer.close(index);
                    //向服务端发送删除指令
                });
            } else if (layEvent === 'update') { //编辑
                //do something
                //同步更新缓存对应的值
                layer.prompt({
                    formType: 0,
                    value: tr.name
                }, function (value, index) {//value为值，index为弹出层
                    obj.update({
                        "name": value
                    })
                    layer.close(index);
                })
            } else if (layEvent === 'LAYTABLE_TIPS') {
                layer.alert('Hi，头部工具栏扩展的右侧图标。');
            }
        });
    </script>

</body>

</html>